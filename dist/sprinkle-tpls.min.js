angular.module("mnd.sprinkle",[]).factory("MndWordProcessingService",function(){return function(n){var e={};if(2===n.length)e.left=n[0],e.pivot=n[1],e.right="";else{var r=Math.ceil(n.length/2-1);e.left=n.slice(0,r),e.right=n.slice(r+1),e.pivot=n.slice(r,r+1)}return e.multiplier=/[\,\:\;]$/g.test(n)?1.5:/[\.\!\?]$/g.test(n)?2:1,e}}).factory("MndWordSplittingService",function(){return function(n){var e=n.split(" ");return e}}).factory("MndTagStrippingService",function(){return function(n){var e=n.replace(/(<([^>]+)>)/gi," ");e=e.replace(/\s+/g," ").trim();var r=document.createElement("p");return r.innerHTML=e,r.textContent}}).factory("MndReadTimeEstimatingService",["MndTagStrippingService",function(){return function(n,e){return Math.round(n/e)}}]).directive("mndSprinkle",["$timeout","MndWordSplittingService","MndWordProcessingService","MndTagStrippingService","MndReadTimeEstimatingService",function(n,e,r,t,i){return{restrict:"EA",templateUrl:"templates/sprinkle.html",scope:{text:"@?",html:"@?",defaultWpm:"@?",wpm:"=?",time:"=?",hideControlBar:"=?",autoplay:"@?",autoplayDelay:"@?",progressPercentage:"=?"},link:function(s){if(s.text)s._words=e(s.text);else{if(!s.html)throw new Error("Nothing to display!");s._text=t(s.html),s._words=e(s._text)}s.wpm=s.wpm||parseInt(s.defaultWpm||"250",10),s.time=i(s._words.length,s.wpm),s._msPerWord=function(){return Math.floor(6e4/s.wpm)},s.increaseSpeed=function(n){var e=s.wpm;e+=n||50,s.wpm=e,s.time=i(s._words.length,s.wpm)},s.decreaseSpeed=function(n){var e=s.wpm;e-=n||50,50>e&&(e=50),s.wpm=e,s.time=i(s._words.length,s.wpm)};var l=function(){var e=s._words[s._wordIndex],t=r(e);s.word=t;var i=t.multiplier*s._msPerWord();s._wordIndex++,s.progressPercentage=s._wordIndex/s._words.length*100,s._wordIndex<s._words.length?s._timeout=n(l,i):(s.running=!1,s._wordIndex=0)};if(s.neverRun=!0,s.running=!1,s._wordIndex=0,s.start=function(){s.neverRun=!1,s.running||(s.running=!0,l())},s.pause=function(){s.running&&(n.cancel(s._timeout),s.running=!1)},s.toggle=function(){s.running?s.pause():s.start()},s.rewind=function(){s._wordIndex=0},s.stop=function(){s.pause(),s.rewind()},"true"===s.autoplay){var a=parseInt(s.autoplayDelay,10),o=isNaN(a)?0:a;n(function(){s.start()},1e3*o)}s.toggleControlBar=function(){s.hideControlBar=!s.hideControlBar}}}}]),function(n){try{n=angular.module("mnd.sprinkle")}catch(e){n=angular.module("mnd.sprinkle",[])}n.run(["$templateCache",function(n){n.put("templates/sprinkle.html",'<div class="sprinkle-container">\n	<div class="sprinkle-result" ng-click="toggle();">\n		<span ng-if="neverRun" class="sprinkle-never-run">\n			tap to start reading\n		</span>\n		<span class="sprinkle-left">\n			&nbsp;\n			{{word.left}}\n		</span>\n		<span class="sprinkle-pivot">\n			<div class="sprinkle-center-line-top"></div>\n			<div class="sprinkle-center-line-bottom"></div>	\n			{{word.pivot || "&nbsp;"}}\n		</span>\n		<span class="sprinkle-right">\n			{{word.right}}\n		</span>\n	</div>\n	<div class="sprinkle-control-bar" ng-if="!hideControlBar">\n		<div class="sprinkle-control-bar-left">\n			<div class="sprinkle-control-btn" ng-click="rewind()"><i class="fa fa-refresh"></i></div>\n			<div class="sprinkle-control-btn" ng-if="running" ng-click="pause()"><i class="fa fa-pause"></i></div>\n			<div class="sprinkle-control-btn" ng-if="!running" ng-click="start()"><i class="fa fa-play"></i></div>\n		</div>\n		<div class="sprinkle-control-bar-right">\n			<div class="sprinkle-control-btn" ng-click="decreaseSpeed()"><i class="fa fa-minus"></i></div>\n			<div class="sprinkle-control-wpm">{{wpm}} wpm </div>\n			<div class="sprinkle-control-btn" ng-click="increaseSpeed()"><i class="fa fa-plus"></i></div>\n		</div>\n	</div>\n</div>\n')}])}();